<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>rCore ch1 åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸åŸºæœ¬æ‰§è¡Œç¯å¢ƒ | Somewan world</title><meta name="author" content="Some"><meta name="copyright" content="Some"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒç”¨ Cargo å·¥å…·åˆ›å»º Rust é¡¹ç›®ã€‚ 1234567891011$ cargo new osæ­¤æ—¶ï¼Œé¡¹ç›®çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š$ tree ososâ”œâ”€â”€ Cargo.tomlâ””â”€â”€ src    â””â”€â”€ main.rs1 directory, 2 files å…¶ä¸­Â Cargo.tomlÂ ä¸­ä¿å­˜äº†é¡¹ç›®çš„åº“ä¾èµ–ã€ä½œè€…ä¿¡æ¯ç­‰ã€‚ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ã€é“¾æ¥å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ—¶éœ€è¦çŸ¥é“ï¼Œç¨‹åºè¦">
<meta property="og:type" content="article">
<meta property="og:title" content="rCore ch1 åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸åŸºæœ¬æ‰§è¡Œç¯å¢ƒ">
<meta property="og:url" content="http://example.com/2024/04/30/rCore-ch1/index.html">
<meta property="og:site_name" content="Somewan world">
<meta property="og:description" content="åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒç”¨ Cargo å·¥å…·åˆ›å»º Rust é¡¹ç›®ã€‚ 1234567891011$ cargo new osæ­¤æ—¶ï¼Œé¡¹ç›®çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š$ tree ososâ”œâ”€â”€ Cargo.tomlâ””â”€â”€ src    â””â”€â”€ main.rs1 directory, 2 files å…¶ä¸­Â Cargo.tomlÂ ä¸­ä¿å­˜äº†é¡¹ç›®çš„åº“ä¾èµ–ã€ä½œè€…ä¿¡æ¯ç­‰ã€‚ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ã€é“¾æ¥å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ—¶éœ€è¦çŸ¥é“ï¼Œç¨‹åºè¦">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img2.imgtp.com/2024/04/30/2GRAsC33.jpg">
<meta property="article:published_time" content="2024-04-30T05:48:44.000Z">
<meta property="article:modified_time" content="2024-05-05T08:33:55.950Z">
<meta property="article:author" content="Some">
<meta property="article:tag" content="Rust-learningğŸ¦€">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2.imgtp.com/2024/04/30/2GRAsC33.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2024/04/30/rCore-ch1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'rCore ch1 åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸åŸºæœ¬æ‰§è¡Œç¯å¢ƒ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-05 16:33:55'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://img2.imgtp.com/2024/04/30/NSnFYQHs.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img2.imgtp.com/2024/04/30/2GRAsC33.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Somewan world"><span class="site-name">Somewan world</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">rCore ch1 åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸åŸºæœ¬æ‰§è¡Œç¯å¢ƒ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-04-30T05:48:44.000Z" title="å‘è¡¨äº 2024-04-30 13:48:44">2024-04-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-05-05T08:33:55.950Z" title="æ›´æ–°äº 2024-05-05 16:33:55">2024-05-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Rust%F0%9F%A6%80/">RustğŸ¦€</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">4.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>16åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="rCore ch1 åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸åŸºæœ¬æ‰§è¡Œç¯å¢ƒ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒ"><a href="#åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒ" class="headerlink" title="åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒ"></a>åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒ</h1><p>ç”¨ Cargo å·¥å…·åˆ›å»º Rust é¡¹ç›®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">$ cargo new os<br><br>æ­¤æ—¶ï¼Œé¡¹ç›®çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š<br><br>$ tree os<br>os<br>â”œâ”€â”€ Cargo.toml<br>â””â”€â”€ src<br>    â””â”€â”€ main.rs<br><br>1 directory, 2 files<br></code></pre></td></tr></table></figure>
<p>å…¶ä¸­Â <code>Cargo.toml</code>Â ä¸­ä¿å­˜äº†é¡¹ç›®çš„åº“ä¾èµ–ã€ä½œè€…ä¿¡æ¯ç­‰ã€‚</p>
<p>ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ã€é“¾æ¥å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ—¶éœ€è¦çŸ¥é“ï¼Œç¨‹åºè¦åœ¨å“ªä¸ªÂ <strong>å¹³å°</strong>Â (Platform) ä¸Šè¿è¡Œ<br><strong>ç›®æ ‡ä¸‰å…ƒç»„</strong>Â (Target Triplet) æè¿°äº†ç›®æ ‡å¹³å°çš„ <strong>CPU æŒ‡ä»¤é›†ã€æ“ä½œç³»ç»Ÿç±»å‹ã€æ ‡å‡†è¿è¡Œæ—¶åº“</strong></p>
<p>æˆ‘ä»¬å¸Œæœ›æŠŠç¨‹åºç§»æ¤åˆ° RISC-V ç›®æ ‡å¹³å°Â <strong><code>riscv64gc-unknown-none-elf</code></strong>Â ä¸Šè¿è¡Œ</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#123;<br>$ cargo run --target riscv64gc-unknown-none-elf<br>   Compiling os v0.1.0 (/home/shinbokuow/workspace/v3/rCore-Tutorial-v3/os)<br>error[E0463]: can&#x27;t find crate for `std`<br>  |<br>  = note: the `riscv64gc-unknown-none-elf` target may not be installed<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<p>æŠ¥é”™çš„åŸå› æ˜¯ç›®æ ‡å¹³å°ä¸Šç¡®å®æ²¡æœ‰ Rust æ ‡å‡†åº“ stdï¼Œä¹Ÿä¸å­˜åœ¨ä»»ä½•å— OS æ”¯æŒçš„ç³»ç»Ÿè°ƒç”¨ã€‚ è¿™æ ·çš„å¹³å°è¢«æˆ‘ä»¬ç§°ä¸ºÂ <strong>è£¸æœºå¹³å°</strong>Â (bare-metal)ã€‚</p>
<p>é™¤äº† std ä¹‹å¤–ï¼ŒRust è¿˜æœ‰ä¸€ä¸ªä¸éœ€è¦ä»»ä½•æ“ä½œç³»ç»Ÿæ”¯æŒçš„æ ¸å¿ƒåº“ coreï¼Œ å®ƒåŒ…å«äº† Rust è¯­è¨€ç›¸å½“ä¸€éƒ¨åˆ†æ ¸å¿ƒæœºåˆ¶ï¼Œä¸ºäº†ä»¥è£¸æœºå¹³å°ä¸ºç›®æ ‡ç¼–è¯‘ç¨‹åºï¼Œæˆ‘ä»¬è¦å°†å¯¹æ ‡å‡†åº“ std çš„å¼•ç”¨æ¢æˆæ ¸å¿ƒåº“ core</p>
<h1 id="ç§»é™¤æ ‡å‡†åº“ä¾èµ–"><a href="#ç§»é™¤æ ‡å‡†åº“ä¾èµ–" class="headerlink" title="ç§»é™¤æ ‡å‡†åº“ä¾èµ–"></a>ç§»é™¤æ ‡å‡†åº“ä¾èµ–</h1><hr>
<p>é¦–å…ˆåœ¨Â <code>os</code>Â ç›®å½•ä¸‹æ–°å»ºÂ <code>.cargo</code>Â ç›®å½•ï¼Œå¹¶åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºÂ <code>config</code>Â æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># os/.cargo/config<br>[build]<br>target = &quot;riscv64gc-unknown-none-elf&quot;<br></code></pre></td></tr></table></figure>
<p>è¿™å°†ä½¿ cargo å·¥å…·åœ¨ os ç›®å½•ä¸‹é»˜è®¤ä¼šä½¿ç”¨ riscv64gc-unknown-none-elf ä½œä¸ºç›®æ ‡å¹³å°ã€‚ è¿™ç§ç¼–è¯‘å™¨è¿è¡Œçš„å¹³å°ï¼ˆx86_64ï¼‰ä¸å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œçš„ç›®æ ‡å¹³å°ä¸åŒçš„æƒ…å†µï¼Œç§°ä¸ºÂ <strong>äº¤å‰ç¼–è¯‘</strong>Â (Cross Compile)ã€‚</p>
<hr>
<h2 id="ç§»é™¤-println-å®"><a href="#ç§»é™¤-println-å®" class="headerlink" title="ç§»é™¤ println! å®"></a>ç§»é™¤ println! å®</h2><p>åœ¨ <code>main.rs</code> å¼€å¤´åŠ å…¥ <code>#![no_std]</code> ï¼Œå‘Šè¯‰ Rust ç¼–è¯‘å™¨ä¸ä½¿ç”¨ Rust æ ‡å‡†åº“ std è½¬è€Œä½¿ç”¨æ ¸å¿ƒåº“ coreã€‚<br>println! å®æ˜¯ç”±æ ‡å‡†åº“ std æä¾›çš„ï¼Œä¸”ä¼šä½¿ç”¨åˆ°ä¸€ä¸ªåä¸º write çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬å…ˆå°†è¿™è¡Œä»£ç æ³¨é‡Šæ‰ã€‚</p>
<hr>
<h2 id="æä¾›è¯­ä¹‰é¡¹-panic-handler"><a href="#æä¾›è¯­ä¹‰é¡¹-panic-handler" class="headerlink" title="æä¾›è¯­ä¹‰é¡¹ panic_handler"></a>æä¾›è¯­ä¹‰é¡¹ panic_handler</h2><p>æ ‡å‡†åº“ std æä¾›äº† Rust é”™è¯¯å¤„ç†å‡½æ•°Â <code>#[panic_handler]</code>ï¼Œå…¶å¤§è‡´åŠŸèƒ½æ˜¯æ‰“å°å‡ºé”™ä½ç½®å’ŒåŸå› å¹¶æ€æ­»å½“å‰åº”ç”¨ã€‚ ä½†æ ¸å¿ƒåº“ core å¹¶æ²¡æœ‰æä¾›è¿™é¡¹åŠŸèƒ½ï¼Œå¾—é æˆ‘ä»¬è‡ªå·±å®ç°ã€‚<br>æ–°å»ºä¸€ä¸ªå­æ¨¡å—Â <code>lang_items.rs</code>ï¼Œåœ¨é‡Œé¢ç¼–å†™ panic å¤„ç†å‡½æ•°ï¼Œé€šè¿‡æ ‡è®°Â <code>#[panic_handler]</code>Â å‘ŠçŸ¥ç¼–è¯‘å™¨é‡‡ç”¨æˆ‘ä»¬çš„å®ç°ï¼š</p>
<hr>
<p><strong><code>#[panic_handler]</code>Â æ˜¯ä¸€ä¸ª Rust å±æ€§ï¼ˆattributeï¼‰ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªå‡½æ•°ä½œä¸º panic å‘ç”Ÿæ—¶çš„å¤„ç†å‡½æ•°ã€‚å½“ç¨‹åºå‘ç”Ÿ panicï¼ˆå³é‡åˆ°äº†æ— æ³•æ¢å¤çš„é”™è¯¯ï¼‰æ—¶ï¼ŒRust è¿è¡Œæ—¶ä¼šè°ƒç”¨è¿™ä¸ªæŒ‡å®šçš„å‡½æ•°æ¥å¤„ç† panicã€‚</strong><br><code>PanicInfo</code>Â ç»“æ„ä½“ä½äºÂ <code>core::panic</code>Â æ¨¡å—ä¸­ï¼Œå®ƒåŒ…å«äº†ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºè·å–æœ‰å…³ panic çš„ä¿¡æ¯ã€‚ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>payload()</code>ï¼š è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘ panic çš„ payload æ•°æ®ï¼Œå³ panic çš„å…·ä½“ä¿¡æ¯ã€‚</li>
<li><code>message()</code>ï¼š è¿”å›ä¸€ä¸ªÂ <code>Option&lt;&amp;Any&gt;</code>ï¼Œå…¶ä¸­åŒ…å«äº†å¯¹ panic çš„æè¿°ä¿¡æ¯ï¼Œå¦‚æœæœ‰çš„è¯ã€‚</li>
<li><code>location()</code>ï¼šè¿”å›ä¸€ä¸ªÂ <code>Option&lt;&amp;Location&gt;</code>ï¼Œå…¶ä¸­åŒ…å«äº† panic å‘ç”Ÿçš„æºä»£ç ä½ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€è¡Œå·å’Œåˆ—å·ã€‚</li>
</ul>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/src/lang_items.rs<br>use core::panic::PanicInfo;<br><br>#[panic_handler]<br>fn panic(_info: &amp;PanicInfo) -&gt; ! &#123;<br>    loop &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ç›®å‰æˆ‘ä»¬é‡åˆ°é”™è¯¯ä»€ä¹ˆéƒ½ä¸åšï¼Œåªåœ¨åŸåœ°Â <code>loop</code></p>
<hr>
<h2 id="ç§»é™¤-main-å‡½æ•°"><a href="#ç§»é™¤-main-å‡½æ•°" class="headerlink" title="ç§»é™¤ main å‡½æ•°"></a>ç§»é™¤ main å‡½æ•°</h2><p>æˆ‘ä»¬ç¼ºå°‘ä¸€ä¸ªåä¸ºÂ <code>start</code>Â çš„è¯­ä¹‰é¡¹ã€‚Â <code>start</code>Â è¯­ä¹‰é¡¹ä»£è¡¨äº†æ ‡å‡†åº“ std åœ¨æ‰§è¡Œåº”ç”¨ç¨‹åºä¹‹å‰éœ€è¦è¿›è¡Œçš„ä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚ç”±äºæˆ‘ä»¬ç¦ç”¨äº†æ ‡å‡†åº“ï¼Œ<strong>ç¼–è¯‘å™¨ä¹Ÿå°±æ‰¾ä¸åˆ°è¿™é¡¹åŠŸèƒ½çš„å®ç°äº†</strong>ã€‚<br>åœ¨Â <code>main.rs</code>Â çš„å¼€å¤´åŠ å…¥è®¾ç½®Â <code>#![no_main]</code>Â å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘ä»¬æ²¡æœ‰ä¸€èˆ¬æ„ä¹‰ä¸Šçš„Â <code>main</code>Â å‡½æ•°ï¼Œ å¹¶å°†åŸæ¥çš„Â <code>main</code>Â å‡½æ•°åˆ é™¤ã€‚è¿™æ ·ç¼–è¯‘å™¨ä¹Ÿå°±ä¸éœ€è¦è€ƒè™‘åˆå§‹åŒ–å·¥ä½œäº†ã€‚</p>
<hr>
<h2 id="åˆ†æè¢«ç§»é™¤æ ‡å‡†åº“çš„ç¨‹åº"><a href="#åˆ†æè¢«ç§»é™¤æ ‡å‡†åº“çš„ç¨‹åº" class="headerlink" title="åˆ†æè¢«ç§»é™¤æ ‡å‡†åº“çš„ç¨‹åº"></a>åˆ†æè¢«ç§»é™¤æ ‡å‡†åº“çš„ç¨‹åº</h2><p>é€šè¿‡Â <code>file</code>Â å·¥å…·å¯¹äºŒè¿›åˆ¶ç¨‹åºÂ <code>os</code>Â çš„åˆ†æï¼Œå®ƒå¥½åƒæ˜¯ä¸€ä¸ªåˆæ³•çš„ RISC-V64 æ‰§è¡Œç¨‹åºï¼Œ ä½†Â <code>rust-readobj</code>Â å·¥å…·å‘Šè¯‰æˆ‘ä»¬å®ƒçš„å…¥å£åœ°å€ Entry æ˜¯Â <code>0</code>ã€‚ å†é€šè¿‡Â <code>rust-objdump</code>Â å·¥å…·æŠŠå®ƒåæ±‡ç¼–ï¼Œæ²¡æœ‰ç”Ÿæˆä»»ä½•æ±‡ç¼–ä»£ç ã€‚ å¯è§ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶ç¨‹åºè™½ç„¶åˆæ³•ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªç©ºç¨‹åºï¼ŒåŸå› æ˜¯ç¼ºå°‘äº†ç¼–è¯‘å™¨è§„å®šçš„å…¥å£å‡½æ•°Â <code>_start</code></p>
<h1 id="æ„å»ºç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ"><a href="#æ„å»ºç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ" class="headerlink" title="æ„å»ºç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ"></a>æ„å»ºç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ</h1><hr>
<h2 id="æ‰§è¡Œç¯å¢ƒåˆå§‹åŒ–"><a href="#æ‰§è¡Œç¯å¢ƒåˆå§‹åŒ–" class="headerlink" title="æ‰§è¡Œç¯å¢ƒåˆå§‹åŒ–"></a>æ‰§è¡Œç¯å¢ƒåˆå§‹åŒ–</h2><p>ç»™ Rust ç¼–è¯‘å™¨ç¼–è¯‘å™¨æä¾›å…¥å£å‡½æ•°Â <code>_start()</code>Â ï¼Œ åœ¨Â <code>main.rs</code>Â ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<hr>
<p><strong><code>#[no_mangle]</code>Â æ˜¯ Rust è¯­è¨€ä¸­çš„ä¸€ä¸ªå±æ€§ï¼ˆattributeï¼‰ï¼Œç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ç¦æ­¢ä¿®æ”¹å‡½æ•°åæˆ–ç¬¦å·åçš„è§„åˆ™ã€‚å½“ä½¿ç”¨Â <code>#[no_mangle]</code>Â å±æ€§ä¿®é¥°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨å°†ä¿æŒå‡½æ•°åæˆ–ç¬¦å·åä¸å˜ï¼Œä¸ä¼šå°†å…¶è¿›è¡Œé‡å‘½åæˆ–ä¿®é¥°ã€‚</strong><br>åœ¨ Rust ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šå¯¹å‡½æ•°åè¿›è¡Œä¿®é¥°ï¼Œä»¥ç¡®ä¿å‡½æ•°ååœ¨äºŒè¿›åˆ¶ä¸­çš„å”¯ä¸€æ€§ã€‚è¿™æ˜¯ä¸ºäº†æ”¯æŒ Rust çš„æ¨¡å—ç³»ç»Ÿå’Œåç§°ç©ºé—´éš”ç¦»ã€‚ä¿®é¥°çš„æ–¹å¼å¯èƒ½åŒ…æ‹¬æ·»åŠ å‰ç¼€ã€åç¼€ã€å“ˆå¸Œå€¼ç­‰ï¼Œå…·ä½“å–å†³äºç¼–è¯‘å™¨å’Œå¹³å°ã€‚<br>æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ Rust ä»£ç ä¸­ä½¿ç”¨å…·æœ‰ç‰¹å®šåç§°çš„å‡½æ•°ï¼Œä¾‹å¦‚ä¸å…¶ä»–è¯­è¨€è¿›è¡Œäº¤äº’æˆ–é“¾æ¥åˆ°å¤–éƒ¨åº“ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â <code>#[no_mangle]</code>Â å±æ€§æ¥å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦ä¿®æ”¹å‡½æ•°åã€‚<br>åœ¨ä»£ç ç¤ºä¾‹ä¸­ï¼Œ<code>extern &quot;C&quot; fn _start()</code>Â å‡½æ•°å‰é¢çš„Â <code>#[no_mangle]</code>Â å±æ€§ç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šå¯¹Â <code>_start</code>Â å‡½æ•°è¿›è¡Œä»»ä½•ä¿®é¥°æˆ–é‡å‘½åã€‚è¿™æ˜¯å› ä¸ºåœ¨ä¸€äº›æ“ä½œç³»ç»Ÿæˆ–åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨Â <code>_start</code>Â å‡½æ•°ä½œä¸ºç¨‹åºçš„å…¥å£ç‚¹æ˜¯ä¸€ç§çº¦å®šã€‚</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/src/main.rs<br>#[no_mangle]<br>extern &quot;C&quot; fn _start() &#123;<br>    loop&#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="ç¨‹åºæ­£å¸¸é€€å‡º"><a href="#ç¨‹åºæ­£å¸¸é€€å‡º" class="headerlink" title="ç¨‹åºæ­£å¸¸é€€å‡º"></a>ç¨‹åºæ­£å¸¸é€€å‡º</h2><p>æŠŠÂ <code>_start()</code>Â å‡½æ•°ä¸­çš„å¾ªç¯è¯­å¥æ³¨é‡Šæ‰ï¼Œé‡æ–°ç¼–è¯‘å¹¶åˆ†æï¼Œçœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ‰§è¡Œç¨‹åºã€‚ä½†å¦‚æœæˆ‘ä»¬æ‰§è¡Œå®ƒï¼Œå´ä¼šå¼•å‘ <code>segment fault</code><br>è¿™ä¸ªç®€å•çš„ç¨‹åºå¯¼è‡´Â <code>qemu-riscv64</code>Â å´©æºƒäº†ï¼ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p>
<hr>
<p>QEMUæœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š</p>
<p><code>UserÂ mode</code>Â æ¨¡å¼ï¼Œå³ç”¨æˆ·æ€æ¨¡æ‹Ÿï¼Œå¦‚Â <code>qemu-riscv64</code>Â ç¨‹åºï¼Œ èƒ½å¤Ÿæ¨¡æ‹Ÿä¸åŒå¤„ç†å™¨çš„ç”¨æˆ·æ€æŒ‡ä»¤çš„æ‰§è¡Œï¼Œå¹¶å¯ä»¥ç›´æ¥è§£æELFå¯æ‰§è¡Œæ–‡ä»¶ï¼Œ åŠ è½½è¿è¡Œé‚£äº›ä¸ºä¸åŒå¤„ç†å™¨ç¼–è¯‘çš„ç”¨æˆ·çº§Linuxåº”ç”¨ç¨‹åºã€‚<br><code>SystemÂ mode</code>Â æ¨¡å¼ï¼Œå³ç³»ç»Ÿæ€æ¨¡å¼ï¼Œå¦‚Â <code>qemu-system-riscv64</code>Â ç¨‹åºï¼Œ èƒ½å¤Ÿæ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„åŸºäºä¸åŒCPUçš„ç¡¬ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¤„ç†å™¨ã€å†…å­˜åŠå…¶ä»–å¤–éƒ¨è®¾å¤‡ï¼Œæ”¯æŒè¿è¡Œå®Œæ•´çš„æ“ä½œç³»ç»Ÿã€‚</p>
<hr>
<p>ç›®å‰çš„æ‰§è¡Œç¯å¢ƒè¿˜ç¼ºäº†ä¸€ä¸ªé€€å‡ºæœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æ“ä½œç³»ç»Ÿæä¾›çš„Â <code>exit</code>Â ç³»ç»Ÿè°ƒç”¨æ¥é€€å‡ºç¨‹åº</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/src/main.rs<br><br>const SYSCALL_EXIT: usize = 93;<br><br>fn syscall(id: usize, args: [usize; 3]) -&gt; isize &#123;<br>    let mut ret;<br>    unsafe &#123;<br>        core::arch::asm!(<br>            &quot;ecall&quot;,<br>            inlateout(&quot;x10&quot;) args[0] =&gt; ret,<br>            in(&quot;x11&quot;) args[1],<br>            in(&quot;x12&quot;) args[2],<br>            in(&quot;x17&quot;) id,<br>        );<br>    &#125;<br>    ret<br>&#125;<br><br>pub fn sys_exit(xstate: i32) -&gt; isize &#123;<br>    syscall(SYSCALL_EXIT, [xstate as usize, 0, 0])<br>&#125;<br><br>#[no_mangle]<br>extern &quot;C&quot; fn _start() &#123;<br>    sys_exit(9);<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="æœ‰æ˜¾ç¤ºæ”¯æŒçš„ç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ"><a href="#æœ‰æ˜¾ç¤ºæ”¯æŒçš„ç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ" class="headerlink" title="æœ‰æ˜¾ç¤ºæ”¯æŒçš„ç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ"></a>æœ‰æ˜¾ç¤ºæ”¯æŒçš„ç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ</h2><p>Rust çš„ core åº“å†…å»ºäº†ä»¥ä¸€ç³»åˆ—å¸®åŠ©å®ç°æ˜¾ç¤ºå­—ç¬¦çš„åŸºæœ¬ Trait å’Œæ•°æ®ç»“æ„ï¼Œå‡½æ•°ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶ä¸­çš„å…³é”®éƒ¨åˆ†è¿›è¡Œæ‰©å±•ï¼Œå°±å¯ä»¥å®ç°å®šåˆ¶çš„Â <code>println!</code>Â åŠŸèƒ½</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">use core::fmt::Write<br>use core::fmt<br><br>//å°è£…ä¸€ä¸‹å¯¹Â `SYSCALL_WRITE`Â ç³»ç»Ÿè°ƒç”¨<br>const SYSCALL_WRITE: usize = 64;<br><br>pub fn sys_write(fd: usize, buffer: &amp;[u8]) -&gt; isize &#123;<br>  syscall(SYSCALL_WRITE, [fd, buffer.as_ptr() as usize, buffer.len()])<br>&#125;<br><br>//å®ç°åŸºäºÂ `Write`Â Trait çš„æ•°æ®ç»“æ„ï¼Œå¹¶å®ŒæˆÂ `Write`Â Trait æ‰€éœ€è¦çš„Â `write_str`Â å‡½æ•°ï¼Œå¹¶ç”¨Â `print`Â å‡½æ•°è¿›è¡ŒåŒ…è£…<br>struct Stdout;<br><br>impl Write for Stdout &#123;<br>    fn write_str(&amp;mut self, s: &amp;str) -&gt; fmt::Result &#123;<br>        sys_write(1, s.as_bytes());<br>        Ok(())<br>    &#125;<br>&#125;<br><br>pub fn print(args: fmt::Arguments) &#123;<br>    Stdout.write_fmt(args).unwrap();<br>&#125;<br><br>//å®ç°åŸºäºÂ `print`Â å‡½æ•°ï¼Œå®ç°Rustè¯­è¨€ æ ¼å¼åŒ–å®(formatting macros)<br>#[macro_export]<br>macro_rules! print &#123;<br>    ($fmt: literal $(, $($arg: tt)+)?) =&gt; &#123;<br>        $crate::console::print(format_args!($fmt $(, $($arg)+)?));<br>    &#125;<br>&#125;<br><br>#[macro_export]<br>macro_rules! println &#123;<br>    ($fmt: literal $(, $($arg: tt)+)?) =&gt; &#123;<br>        print(format_args!(concat!($fmt, &quot;\n&quot;) $(, $($arg)+)?));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<p>è°ƒæ•´ä¸€ä¸‹åº”ç”¨ç¨‹åºï¼Œè®©å®ƒå‘å‡ºæ˜¾ç¤ºå­—ç¬¦ä¸²å’Œé€€å‡ºçš„è¯·æ±‚</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#[no_mangle]<br>extern &quot;C&quot; fn _start() &#123;<br>    println!(&quot;Hello, world!&quot;);<br>    sys_exit(9);<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h1 id="æ„å»ºè£¸æœºæ‰§è¡Œç¯å¢ƒ"><a href="#æ„å»ºè£¸æœºæ‰§è¡Œç¯å¢ƒ" class="headerlink" title="æ„å»ºè£¸æœºæ‰§è¡Œç¯å¢ƒ"></a>æ„å»ºè£¸æœºæ‰§è¡Œç¯å¢ƒ</h1><hr>
<h2 id="è£¸æœºå¯åŠ¨è¿‡ç¨‹"><a href="#è£¸æœºå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="è£¸æœºå¯åŠ¨è¿‡ç¨‹"></a>è£¸æœºå¯åŠ¨è¿‡ç¨‹</h2><p>ç”¨ QEMU è½¯ä»¶Â <code>qemu-system-riscv64</code>Â æ¥æ¨¡æ‹Ÿ RISC-V 64 è®¡ç®—æœºï¼š</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">$ qemu-system-riscv64 -machine virt -nographic -bios $(BOOTLOADER) -device loader,file=$(KERNEL_BIN),addr=$(KERNEL_ENTRY_PA)<br></code></pre></td></tr></table></figure>
<ul>
<li><code>-biosÂ $(BOOTLOADER)</code>Â æ„å‘³ç€ç¡¬ä»¶åŠ è½½äº†ä¸€ä¸ª BootLoader ç¨‹åºï¼Œå³ RustSBI</li>
<li><code>-deviceÂ loader,file=$(KERNEL_BIN),addr=$(KERNEL_ENTRY_PA)</code>Â è¡¨ç¤ºç¡¬ä»¶å†…å­˜ä¸­çš„ç‰¹å®šä½ç½®Â <code>$(KERNEL_ENTRY_PA)</code>Â æ”¾ç½®äº†æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶ä»£ç Â <code>$(KERNEL_BIN)</code> <code>$(KERNEL_ENTRY_PA)</code>Â çš„å€¼æ˜¯Â <code>0x80200000</code></li>
</ul>
<hr>
<p><strong>æ‰§è¡ŒåŒ…å«ä¸Šè¿°å¯åŠ¨å‚æ•°çš„ qemu-system-riscv64 è½¯ä»¶ï¼Œå°±æ„å‘³ç»™è¿™å°è™šæ‹Ÿçš„ RISC-V64 è®¡ç®—æœºåŠ ç”µäº†ã€‚ æ­¤æ—¶ï¼ŒCPU çš„å…¶å®ƒé€šç”¨å¯„å­˜å™¨æ¸…é›¶ï¼Œè€Œ PC ä¼šæŒ‡å‘Â <code>0x1000</code>Â çš„ä½ç½®ï¼Œè¿™é‡Œæœ‰å›ºåŒ–åœ¨ç¡¬ä»¶ä¸­çš„ä¸€å°æ®µå¼•å¯¼ä»£ç ï¼Œ å®ƒä¼šå¾ˆå¿«è·³è½¬åˆ°Â <code>0x80000000</code>Â çš„ RustSBI å¤„ã€‚ RustSBIå®Œæˆç¡¬ä»¶åˆå§‹åŒ–åï¼Œä¼šè·³è½¬åˆ°Â <code>$(KERNEL_BIN)</code>Â æ‰€åœ¨å†…å­˜ä½ç½®Â <code>0x80200000</code>Â å¤„ï¼Œ æ‰§è¡Œæ“ä½œç³»ç»Ÿçš„ç¬¬ä¸€æ¡æŒ‡ä»¤</strong><br>![[Pasted image 20240428224902.png]]</p>
<hr>
<p>SBIï¼ˆRust Supervisor Binary Interfaceï¼‰æ˜¯ RISC-V çš„ä¸€ç§åº•å±‚è§„èŒƒï¼ŒRustSBI æ˜¯å®ƒçš„ä¸€ç§å®ç°ã€‚ æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ RustSBI çš„å…³ç³»æœ‰ç‚¹åƒåº”ç”¨ä¸æ“ä½œç³»ç»Ÿå†…æ ¸çš„å…³ç³»ï¼Œåè€…å‘å‰è€…æä¾›ä¸€å®šçš„æœåŠ¡ã€‚åªæ˜¯SBIæä¾›çš„æœåŠ¡å¾ˆå°‘ï¼Œ æ¯”å¦‚å…³æœºï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸²ç­‰ã€‚</p>
<hr>
<h2 id="å®ç°å…³æœºåŠŸèƒ½"><a href="#å®ç°å…³æœºåŠŸèƒ½" class="headerlink" title="å®ç°å…³æœºåŠŸèƒ½"></a>å®ç°å…³æœºåŠŸèƒ½</h2><p>é€šè¿‡Â <code>ecall</code>Â è°ƒç”¨ RustSBI å®ç°å…³æœºåŠŸèƒ½</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// bootloader/rustsbi-qemu.bin ç›´æ¥æ·»åŠ çš„SBIè§„èŒƒå®ç°çš„äºŒè¿›åˆ¶ä»£ç ï¼Œç»™æ“ä½œç³»ç»Ÿæä¾›åŸºæœ¬æ”¯æŒæœåŠ¡<br></code></pre></td></tr></table></figure>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/src/sbi.rs<br>fn sbi_call(which: usize, arg0: usize, arg1: usize, arg2: usize) -&gt; usize &#123;<br>Â  Â  let mut ret;<br>Â  Â  unsafe &#123;<br>Â  Â  Â  Â  asm!(<br>Â  Â  Â  Â  Â  Â  &quot;li x16, 0&quot;,<br>Â  Â  Â  Â  Â  Â  &quot;ecall&quot;,<br>Â  Â  Â  Â  Â  Â  inlateout(&quot;x10&quot;) arg0 =&gt; ret,<br>Â  Â  Â  Â  Â  Â  in(&quot;x11&quot;) arg1,<br>Â  Â  Â  Â  Â  Â  in(&quot;x12&quot;) arg2,<br>Â  Â  Â  Â  Â  Â  in(&quot;x17&quot;) which,<br>Â  Â  Â  Â  );<br>Â  Â  &#125;<br>Â  Â  ret<br>&#125;<br><br>const SBI_SHUTDOWN: usize = 8;<br><br>pub fn shutdown() -&gt; ! &#123;<br>    sbi_call(SBI_SHUTDOWN, 0, 0, 0);<br>    panic!(&quot;It should shutdown!&quot;);<br>&#125;<br><br>// os/src/main.rs<br>#[no_mangle]<br>extern &quot;C&quot; fn _start() &#123;<br>    shutdown();<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<p>åº”ç”¨ç¨‹åºè®¿é—®æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨çš„æŒ‡ä»¤æ˜¯Â <code>ecall</code>Â ï¼Œæ“ä½œç³»ç»Ÿè®¿é—® RustSBIæä¾›çš„SBIè°ƒç”¨çš„æŒ‡ä»¤ä¹Ÿæ˜¯Â <code>ecall</code>Â ï¼Œ è™½ç„¶æŒ‡ä»¤ä¸€æ ·ï¼Œä½†å®ƒä»¬æ‰€åœ¨çš„ç‰¹æƒçº§æ˜¯ä¸ä¸€æ ·çš„ã€‚ ç®€å•åœ°è¯´ï¼Œåº”ç”¨ç¨‹åºä½äºæœ€å¼±çš„ç”¨æˆ·ç‰¹æƒçº§ï¼ˆUser Modeï¼‰ï¼Œ æ“ä½œç³»ç»Ÿä½äºå†…æ ¸ç‰¹æƒçº§ï¼ˆSupervisor Modeï¼‰ï¼Œ RustSBIä½äºæœºå™¨ç‰¹æƒçº§ï¼ˆMachine Modeï¼‰<br>ç¼–è¯‘æ‰§è¡Œ:</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># ç¼–è¯‘ç”ŸæˆELFæ ¼å¼çš„æ‰§è¡Œæ–‡ä»¶<br>$ cargo build --release<br> Compiling os v0.1.0 (/media/chyyuu/ca8c7ba6-51b7-41fc-8430-e29e31e5328f/thecode/rust/os_kernel_lab/os)<br>  Finished release [optimized] target(s) in 0.15s<br># æŠŠELFæ‰§è¡Œæ–‡ä»¶è½¬æˆbianaryæ–‡ä»¶<br>$ rust-objcopy --binary-architecture=riscv64 target/riscv64gc-unknown-none-elf/release/os --strip-all -O binary target/riscv64gc-unknown-none-elf/release/os.bin<br><br># åŠ è½½è¿è¡Œ<br>$ qemu-system-riscv64 -machine virt -nographic -bios ../bootloader/rustsbi-qemu.bin -device loader,file=target/riscv64gc-unknown-none-elf/release/os.bin,addr=0x80200000<br># æ— æ³•é€€å‡ºï¼Œé£æ‰‡ç‹‚è½¬ï¼Œæ„Ÿè§‰ç¢°åˆ°æ­»å¾ªç¯<br></code></pre></td></tr></table></figure>
<p>é€šè¿‡ rust-readobj åˆ†æÂ <code>os</code>Â å¯æ‰§è¡Œç¨‹åºï¼Œå‘ç°å…¶å…¥å£åœ°å€ä¸æ˜¯ RustSBI çº¦å®šçš„Â <code>0x80200000</code>Â ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¨‹åºçš„å†…å­˜å¸ƒå±€å¹¶è®¾ç½®å¥½æ ˆç©ºé—´</p>
<hr>
<h2 id="è®¾ç½®æ­£ç¡®çš„ç¨‹åºå†…å­˜å¸ƒå±€"><a href="#è®¾ç½®æ­£ç¡®çš„ç¨‹åºå†…å­˜å¸ƒå±€" class="headerlink" title="è®¾ç½®æ­£ç¡®çš„ç¨‹åºå†…å­˜å¸ƒå±€"></a>è®¾ç½®æ­£ç¡®çš„ç¨‹åºå†…å­˜å¸ƒå±€</h2><p>å¯ä»¥é€šè¿‡Â <strong>é“¾æ¥è„šæœ¬</strong>Â (Linker Script) è°ƒæ•´é“¾æ¥å™¨çš„è¡Œä¸ºï¼Œä½¿å¾—æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜å¸ƒå±€ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p>
<p>ä¿®æ”¹ Cargo çš„é…ç½®æ–‡ä»¶æ¥ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„é“¾æ¥è„šæœ¬Â <code>os/src/linker.ld</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/.cargo/config<br>[build]<br>target = &quot;riscv64gc-unknown-none-elf&quot;<br><br>[target.riscv64gc-unknown-none-elf]<br>rustflags = [<br>    &quot;-Clink-arg=-Tsrc/linker.ld&quot;, &quot;-Cforce-frame-pointers=yes&quot;<br>]<br></code></pre></td></tr></table></figure>
<hr>
<p><code>[target.riscv64gc-unknown-none-elf]</code>Â éƒ¨åˆ†ä¸ºç‰¹å®šç›®æ ‡å¹³å°çš„é…ç½®æä¾›äº† Rust æ ‡å¿—ï¼ˆrustflagsï¼‰ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº†ä¸¤ä¸ª Rust æ ‡å¿—ï¼š</p>
<ol>
<li><code>-Clink-arg=-Tsrc/linker.ld</code>ï¼šè¿™ä¸ªæ ‡å¿—é€šè¿‡Â <code>-Clink-arg</code>Â å°†Â <code>-Tsrc/linker.ld</code>Â ä¼ é€’ç»™é“¾æ¥å™¨ã€‚å®ƒå‘Šè¯‰é“¾æ¥å™¨ä½¿ç”¨ä½äºÂ <code>src/linker.ld</code>Â è·¯å¾„ä¸‹çš„é“¾æ¥å™¨è„šæœ¬æ–‡ä»¶ã€‚</li>
<li><code>-Cforce-frame-pointers=yes</code>ï¼šè¿™ä¸ªæ ‡å¿—é€šè¿‡Â <code>-Cforce-frame-pointers</code>Â å¯ç”¨äº†å¼ºåˆ¶ä½¿ç”¨å¸§æŒ‡é’ˆï¼ˆframe pointerï¼‰ã€‚å¸§æŒ‡é’ˆæ˜¯ä¸€ç§ç”¨äºè°ƒè¯•å’Œå¼‚å¸¸å¤„ç†çš„æŠ€æœ¯ï¼Œå®ƒåœ¨å‡½æ•°è°ƒç”¨æ—¶ä¿å­˜äº†æ ˆå¸§çš„åŸºå€ï¼Œæœ‰åŠ©äºè°ƒè¯•å™¨åœ¨å †æ ˆä¸­å®šä½å‡½æ•°è°ƒç”¨çš„ä½ç½®ã€‚</li>
</ol>
<hr>
<p>å…·ä½“çš„é“¾æ¥è„šæœ¬Â <code>os/src/linker.ld</code>Â å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1 OUTPUT_ARCH(riscv)               //è®¾ç½®äº†ç›®æ ‡å¹³å°ä¸º riscv<br>2 ENTRY(_start)                    //è®¾ç½®äº†æ•´ä¸ªç¨‹åºçš„å…¥å£ç‚¹ä¸ºä¹‹å‰å®šä¹‰çš„å…¨å±€ç¬¦å·Â `_start`<br>3 BASE_ADDRESS = 0x80200000;       //å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡Â `BASE_ADDRESS`Â ä¸ºÂ `0x80200000`Â ï¼ŒRustSBI æœŸæœ›çš„ OS èµ·å§‹åœ°å€<br>4<br>5 SECTIONS                         //å¼€å§‹å®šä¹‰èŠ‚ï¼ˆsectionï¼‰å’Œæ®µï¼ˆsegmentï¼‰çš„å¸ƒå±€å’Œå±æ€§<br>6 &#123;<br>7     . = BASE_ADDRESS;            //å°†é“¾æ¥å™¨çš„å½“å‰ä½ç½®è®¾ç½®ä¸ºÂ `BASE_ADDRESS`ï¼Œå³èµ·å§‹åœ°å€<br>8     skernel = .;                 //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `skernel`ï¼Œè¡¨ç¤ºå†…æ ¸æ®µçš„å¼€å§‹åœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®ï¼ˆèµ·å§‹åœ°å€ï¼‰<br>9<br>10    stext = .;                   //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `stext`ï¼Œè¡¨ç¤ºä»£ç æ®µï¼ˆ`.text`ï¼‰çš„å¼€å§‹åœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>11    .text : &#123;                    //ä»£ç æ®µÂ `.text`<br>12        *(.text.entry)           //åŒ¹é…æ‰€æœ‰Â `.text.entry`Â çš„å†…å®¹<br>13        *(.text .text.*)         //åŒ¹é…æ‰€æœ‰ä»¥Â `.text`Â æˆ–Â `.text.`Â å¼€å¤´çš„å†…å®¹<br>14    &#125;<br>15<br>16    . = ALIGN(4K);               //å°†é“¾æ¥å™¨çš„å½“å‰ä½ç½®å¯¹é½åˆ° 4KB è¾¹ç•Œ<br>17    etext = .;                   //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `etext`ï¼Œè¡¨ç¤ºä»£ç æ®µçš„ç»“æŸåœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>18    srodata = .;                 //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `srodata`ï¼Œåªè¯»æ•°æ®æ®µï¼ˆ.rodataï¼‰çš„å¼€å§‹åœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>19    .rodata : &#123;                  //åªè¯»æ•°æ®æ®µÂ `.rodata`<br>20        *(.rodata .rodata.*)     //åŒ¹é…æ‰€æœ‰Â `.rodata`Â æˆ–Â `.rodata.`Â å¼€å¤´çš„å†…å®¹<br>21    &#125;<br>22<br>23    . = ALIGN(4K);               //å°†é“¾æ¥å™¨çš„å½“å‰ä½ç½®å¯¹é½åˆ° 4KB è¾¹ç•Œ<br>24    erodata = .;                 //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `erodata`ï¼Œè¡¨ç¤ºåªè¯»æ•°æ®æ®µçš„ç»“æŸåœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®             <br>25    sdata = .;                   //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `sdata`ï¼Œè¡¨ç¤ºæ•°æ®æ®µï¼ˆ`.data`ï¼‰çš„å¼€å§‹åœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>26    .data : &#123;                    //æ•°æ®æ®µÂ `.data`<br>27        *(.data .data.*)         //åŒ¹é…æ‰€æœ‰Â `.data`Â æˆ–Â `.data.`Â å¼€å¤´çš„å†…å®¹<br>28    &#125;<br>29<br>30    . = ALIGN(4K);               //å°†é“¾æ¥å™¨çš„å½“å‰ä½ç½®å¯¹é½åˆ° 4KB è¾¹ç•Œ<br>31    edata = .;                   //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `edata`ï¼Œè¡¨ç¤ºæ•°æ®æ®µçš„ç»“æŸåœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>32    .bss : &#123;                     //bss æ®µÂ `.bss`  <br>33        *(.bss.stack)            //åŒ¹é…æ‰€æœ‰Â `.bss.stack`Â çš„å†…å®¹<br>34        sbss = .;                //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `sbss`ï¼Œè¡¨ç¤º bss æ®µçš„å¼€å§‹åœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>35        *(.bss .bss.*)           //åŒ¹é…æ‰€æœ‰ä»¥Â `.bss`Â æˆ–Â `.bss.`Â å¼€å¤´çš„å†…å®¹<br>36    &#125;<br>37<br>38    . = ALIGN(4K);               //å°†é“¾æ¥å™¨çš„å½“å‰ä½ç½®å¯¹é½åˆ° 4KB è¾¹ç•Œ<br>39    ebss = .;                    //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `ebss`ï¼Œè¡¨ç¤º bss æ®µçš„ç»“æŸåœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>40    ekernel = .;                 //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡Â `ekernel`ï¼Œè¡¨ç¤ºå†…æ ¸æ®µçš„ç»“æŸåœ°å€ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºå½“å‰ä½ç½®<br>41<br>42    /DISCARD/ : &#123;                //ä¸¢å¼ƒæ‰€æœ‰Â `.eh_frame`Â æ®µçš„å†…å®¹<br>43        *(.eh_frame)<br>44    &#125;<br>45&#125;<br>46 /*æ¯ä¸ªæ®µéƒ½æœ‰ä¸¤ä¸ªå…¨å±€å˜é‡ç»™å‡ºå…¶èµ·å§‹å’Œç»“æŸåœ°å€ï¼ˆæ¯”å¦‚Â `.text`Â æ®µçš„å¼€å§‹å’Œç»“æŸåœ°å€åˆ†åˆ«æ˜¯ 47Â `stext`Â å’ŒÂ `etext`Â ï¼‰*/<br></code></pre></td></tr></table></figure>
<p><code>.bss</code>ï¼ˆBlock Started by Symbolï¼‰æ˜¯ä¸€ç§åœ¨ç¨‹åºä¸­ç”¨äºå­˜å‚¨æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„æ®µã€‚å®ƒé€šå¸¸ç”¨äºå­˜å‚¨ç¨‹åºä¸­æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨ç¨‹åºå¯åŠ¨æ—¶ä¼šè¢«è‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶æˆ–ç©ºå€¼</p>
<hr>
<h2 id="æ­£ç¡®é…ç½®æ ˆç©ºé—´å¸ƒå±€"><a href="#æ­£ç¡®é…ç½®æ ˆç©ºé—´å¸ƒå±€" class="headerlink" title="æ­£ç¡®é…ç½®æ ˆç©ºé—´å¸ƒå±€"></a>æ­£ç¡®é…ç½®æ ˆç©ºé—´å¸ƒå±€</h2><p>åˆå§‹åŒ–æ ˆç©ºé—´</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># os/src/entry.asm<br>    .section .text.entry<br>    .globl _start<br>_start:<br>    la sp, boot_stack_top<br>    call rust_main<br><br>    .section .bss.stack    <br>    .globl boot_stack<br>boot_stack:<br>    .space 4096 * 16<br>    .globl boot_stack_top<br>boot_stack_top:<br></code></pre></td></tr></table></figure>
<p>é¢„ç•™äº†ä¸€å—å¤§å°ä¸º 4096 * 16 å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯Â 64KiBÂ çš„ç©ºé—´ï¼Œ ç”¨ä½œæ“ä½œç³»ç»Ÿçš„æ ˆç©ºé—´ã€‚ æ ˆé¡¶åœ°å€è¢«å…¨å±€ç¬¦å·Â <code>boot_stack_top</code>Â æ ‡è¯†ï¼Œæ ˆåº•åˆ™è¢«å…¨å±€ç¬¦å·Â <code>boot_stack</code>Â æ ‡è¯†ã€‚ åŒæ—¶ï¼Œè¿™å—æ ˆç©ºé—´è¢«å‘½åä¸ºÂ <code>.bss.stack</code>Â ï¼Œé“¾æ¥è„šæœ¬é‡Œæœ‰å®ƒçš„ä½ç½®</p>
<hr>
<p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨Â <code>main.rs</code>Â ä¸­åµŒå…¥è¿™äº›æ±‡ç¼–ä»£ç å¹¶å£°æ˜åº”ç”¨å…¥å£Â <code>rust_main</code>Â ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/src/main.rs<br>#![no_std]<br>#![no_main]<br><br>mod lang_items;<br><br>core::arch::global_asm!(include_str!(&quot;entry.asm&quot;)); <br>//ä½¿ç”¨Â `global_asm`Â å®ï¼Œå°†åŒç›®å½•ä¸‹çš„æ±‡ç¼–æ–‡ä»¶Â `entry.asm`Â åµŒå…¥åˆ°ä»£ç ä¸­<br><br>#[no_mangle]<br>pub fn rust_main() -&gt; ! &#123;<br>    shutdown();<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="æ¸…ç©º-bssæ®µ"><a href="#æ¸…ç©º-bssæ®µ" class="headerlink" title="æ¸…ç©º.bssæ®µ"></a>æ¸…ç©º.bssæ®µ</h2><p>å†…å­˜ç›¸å…³çš„éƒ¨åˆ†å¤ªå®¹æ˜“å‡ºé”™äº†ï¼ŒÂ <strong>æ¸…é›¶ .bss æ®µ</strong>Â çš„å·¥ä½œè¿˜æ²¡æœ‰å®Œæˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">// os/src/main.rs<br>fn clear_bss() &#123;<br>    extern &quot;C&quot; &#123;<br>        fn sbss();<br>        fn ebss();<br>    &#125;<br>    (sbss as usize..ebss as usize).for_each(|a| &#123;<br>        unsafe &#123; (a as *mut u8).write_volatile(0) &#125;<br>    &#125;);<br>&#125;<br><br>pub fn rust_main() -&gt; ! &#123;<br>    clear_bss();<br>    shutdown();<br></code></pre></td></tr></table></figure>
<h2 id="æ·»åŠ è£¸æœºæ‰“å°ç›¸å…³å‡½æ•°"><a href="#æ·»åŠ è£¸æœºæ‰“å°ç›¸å…³å‡½æ•°" class="headerlink" title="æ·»åŠ è£¸æœºæ‰“å°ç›¸å…³å‡½æ•°"></a>æ·»åŠ è£¸æœºæ‰“å°ç›¸å…³å‡½æ•°</h2><p>åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬ä¸ºç”¨æˆ·æ€ç¨‹åºå®ç°çš„Â <code>println</code>Â å®ï¼Œç•¥ä½œä¿®æ”¹å³å¯ç”¨äºæœ¬èŠ‚çš„å†…æ ¸æ€æ“ä½œç³»ç»Ÿã€‚ è¯¦è§Â <code>os/src/console.rs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">//! SBI console driver, for text output<br>use crate::sbi::console_putchar;<br>use core::fmt::&#123;self, Write&#125;;<br><br>struct Stdout;<br><br>impl Write for Stdout &#123;<br>Â  Â  fn write_str(&amp;mut self, s: &amp;str) -&gt; fmt::Result &#123;<br>Â  Â  Â  Â  for c in s.chars() &#123;<br>Â  Â  Â  Â  Â  Â  console_putchar(c as usize);<br>Â  Â  Â  Â  &#125;<br>Â  Â  Â  Â  Ok(())<br>Â  Â  &#125;<br>&#125;<br><br>pub fn print(args: fmt::Arguments) &#123;<br>Â  Â  Stdout.write_fmt(args).unwrap();<br>&#125;<br><br>/// Print! to the host console using the format string and arguments.<br>#[macro_export]<br>macro_rules! print &#123;<br>Â  Â  ($fmt: literal $(, $($arg: tt)+)?) =&gt; &#123;<br>Â  Â  Â  Â  $crate::console::print(format_args!($fmt $(, $($arg)+)?))<br>Â  Â  &#125;<br>&#125;<br><br>/// Println! to the host console using the format string and arguments.<br>#[macro_export]<br>macro_rules! println &#123;<br>Â  Â  ($fmt: literal $(, $($arg: tt)+)?) =&gt; &#123;<br>Â  Â  Â  Â  $crate::console::print(format_args!(concat!($fmt, &quot;\n&quot;) $(, $($arg)+)?))<br>Â  Â  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">Some</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2024/04/30/rCore-ch1/">http://example.com/2024/04/30/rCore-ch1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com" target="_blank">Somewan world</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Rust-learning%F0%9F%A6%80/">Rust-learningğŸ¦€</a></div><div class="post_share"><div class="social-share" data-image="https://img2.imgtp.com/2024/04/30/2GRAsC33.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/05/03/rCore-lab1/" title="rCore lab1"><img class="cover" src="https://img2.imgtp.com/2024/04/30/LhKcUG0w.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">rCore lab1</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/05/05/Rust-L2/" title="Rust-learning -- æ‰€æœ‰æƒï¼ˆäºŒï¼‰"><img class="cover" src="https://img2.imgtp.com/2024/04/30/xfF78sVD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-05</div><div class="title">Rust-learning -- æ‰€æœ‰æƒï¼ˆäºŒï¼‰</div></div></a></div><div><a href="/2024/05/03/rCore-lab1/" title="rCore lab1"><img class="cover" src="https://img2.imgtp.com/2024/04/30/LhKcUG0w.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-03</div><div class="title">rCore lab1</div></div></a></div><div><a href="/2024/05/04/Rust-L1/" title="Rust-learning -- æ‰€æœ‰æƒï¼ˆä¸€ï¼‰"><img class="cover" src="https://img2.imgtp.com/2024/04/30/cXrphmbj.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-04</div><div class="title">Rust-learning -- æ‰€æœ‰æƒï¼ˆä¸€ï¼‰</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://img2.imgtp.com/2024/04/30/NSnFYQHs.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Some</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/somewan820"><i class="fab fa-github"></i><span>Somewan's world</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/somewan820" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2176978853@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">Rustå­¦ä¹ ä¸­ğŸ¦€|xv6äºŒå‘¨ç›®</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81"><span class="toc-number">1.</span> <span class="toc-text">åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒä¸å¹³å°æ”¯æŒ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E6%A0%87%E5%87%86%E5%BA%93%E4%BE%9D%E8%B5%96"><span class="toc-number">2.</span> <span class="toc-text">ç§»é™¤æ ‡å‡†åº“ä¾èµ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4-println-%E5%AE%8F"><span class="toc-number">2.1.</span> <span class="toc-text">ç§»é™¤ println! å®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E8%AF%AD%E4%B9%89%E9%A1%B9-panic-handler"><span class="toc-number">2.2.</span> <span class="toc-text">æä¾›è¯­ä¹‰é¡¹ panic_handler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4-main-%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">ç§»é™¤ main å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%A2%AB%E7%A7%BB%E9%99%A4%E6%A0%87%E5%87%86%E5%BA%93%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">2.4.</span> <span class="toc-text">åˆ†æè¢«ç§»é™¤æ ‡å‡†åº“çš„ç¨‹åº</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%94%A8%E6%88%B7%E6%80%81%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">3.</span> <span class="toc-text">æ„å»ºç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">æ‰§è¡Œç¯å¢ƒåˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E6%AD%A3%E5%B8%B8%E9%80%80%E5%87%BA"><span class="toc-number">3.2.</span> <span class="toc-text">ç¨‹åºæ­£å¸¸é€€å‡º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E6%98%BE%E7%A4%BA%E6%94%AF%E6%8C%81%E7%9A%84%E7%94%A8%E6%88%B7%E6%80%81%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">3.3.</span> <span class="toc-text">æœ‰æ˜¾ç¤ºæ”¯æŒçš„ç”¨æˆ·æ€æ‰§è¡Œç¯å¢ƒ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%A3%B8%E6%9C%BA%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">4.</span> <span class="toc-text">æ„å»ºè£¸æœºæ‰§è¡Œç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%B8%E6%9C%BA%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">è£¸æœºå¯åŠ¨è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%85%B3%E6%9C%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">4.2.</span> <span class="toc-text">å®ç°å…³æœºåŠŸèƒ½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%AD%A3%E7%A1%AE%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">4.3.</span> <span class="toc-text">è®¾ç½®æ­£ç¡®çš„ç¨‹åºå†…å­˜å¸ƒå±€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E9%85%8D%E7%BD%AE%E6%A0%88%E7%A9%BA%E9%97%B4%E5%B8%83%E5%B1%80"><span class="toc-number">4.4.</span> <span class="toc-text">æ­£ç¡®é…ç½®æ ˆç©ºé—´å¸ƒå±€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA-bss%E6%AE%B5"><span class="toc-number">4.5.</span> <span class="toc-text">æ¸…ç©º.bssæ®µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A3%B8%E6%9C%BA%E6%89%93%E5%8D%B0%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">æ·»åŠ è£¸æœºæ‰“å°ç›¸å…³å‡½æ•°</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/05/16/xv6-lab1/" title="xv6-lab1 utilties"><img src="https://img2.imgtp.com/2024/04/30/QUGWPqLm.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xv6-lab1 utilties"/></a><div class="content"><a class="title" href="/2024/05/16/xv6-lab1/" title="xv6-lab1 utilties">xv6-lab1 utilties</a><time datetime="2024-05-16T07:47:20.000Z" title="å‘è¡¨äº 2024-05-16 15:47:20">2024-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/16/xv6-lab0/" title="xv6-lab0 ç¯å¢ƒé…ç½®"><img src="https://img2.imgtp.com/2024/04/30/xAPVULsi.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xv6-lab0 ç¯å¢ƒé…ç½®"/></a><div class="content"><a class="title" href="/2024/05/16/xv6-lab0/" title="xv6-lab0 ç¯å¢ƒé…ç½®">xv6-lab0 ç¯å¢ƒé…ç½®</a><time datetime="2024-05-16T05:30:20.000Z" title="å‘è¡¨äº 2024-05-16 13:30:20">2024-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/05/Rust-L2/" title="Rust-learning -- æ‰€æœ‰æƒï¼ˆäºŒï¼‰"><img src="https://img2.imgtp.com/2024/04/30/xfF78sVD.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rust-learning -- æ‰€æœ‰æƒï¼ˆäºŒï¼‰"/></a><div class="content"><a class="title" href="/2024/05/05/Rust-L2/" title="Rust-learning -- æ‰€æœ‰æƒï¼ˆäºŒï¼‰">Rust-learning -- æ‰€æœ‰æƒï¼ˆäºŒï¼‰</a><time datetime="2024-05-05T08:48:44.000Z" title="å‘è¡¨äº 2024-05-05 16:48:44">2024-05-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/Rust-L1/" title="Rust-learning -- æ‰€æœ‰æƒï¼ˆä¸€ï¼‰"><img src="https://img2.imgtp.com/2024/04/30/cXrphmbj.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rust-learning -- æ‰€æœ‰æƒï¼ˆä¸€ï¼‰"/></a><div class="content"><a class="title" href="/2024/05/04/Rust-L1/" title="Rust-learning -- æ‰€æœ‰æƒï¼ˆä¸€ï¼‰">Rust-learning -- æ‰€æœ‰æƒï¼ˆä¸€ï¼‰</a><time datetime="2024-05-04T15:48:44.000Z" title="å‘è¡¨äº 2024-05-04 23:48:44">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/03/rCore-lab1/" title="rCore lab1"><img src="https://img2.imgtp.com/2024/04/30/LhKcUG0w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rCore lab1"/></a><div class="content"><a class="title" href="/2024/05/03/rCore-lab1/" title="rCore lab1">rCore lab1</a><time datetime="2024-05-03T11:48:44.000Z" title="å‘è¡¨äº 2024-05-03 19:48:44">2024-05-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://img2.imgtp.com/2024/04/30/2GRAsC33.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2024 By Some</div><div class="footer_custom_text"><p> <a style="margin-inline:5px"target="_blank" href="https://hexo.io/"> <img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸º Hexo" alt="HEXO"> </a> <a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"> <img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨ Butterfly" alt="Butterfly"> </a> <a style="margin-inline:5px"target="_blank" href="https://github.com/"> <img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”± GitHub æ‰˜ç®¡" alt="GitHub"> </a> <a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> <img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"> </a> </p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><a class="magnet_link_more"  href="http://example.com/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><!-- hexo injector body_end end --></body></html>